<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mines Predictor AI</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <style>
    body {
      font-family: Arial;
      text-align: center;
      padding: 20px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-gap: 8px;
      margin: 20px auto;
      width: max-content;
    }
    .tile {
      width: 60px;
      height: 60px;
      background: #ccc;
      border: 1px solid #999;
      line-height: 60px;
      font-weight: bold;
      cursor: pointer;
    }
    .safe {
      background: #6cf;
    }
  </style>
</head>
<body>
  <h1>Mines Predictor AI (TensorFlow)</h1>
  <button id="predictBtn">Predict Safe Tiles</button>
  <div id="board"></div>

  <script>
    const BOARD_SIZE = 25;
    const board = document.getElementById('board');

    // Build 5x5 board
    for (let i = 0; i < BOARD_SIZE; i++) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.id = 'tile-' + i;
      tile.textContent = i;
      board.appendChild(tile);
    }

    // Data Preparer
    function prepareTrainingData(strategies) {
      const inputs = [];
      const labels = [];
      strategies.forEach(strategy => {
        const board = new Array(25).fill(0);
        strategy.safeTiles.forEach(i => board[i] = 1);
        inputs.push(board);

        const label = new Array(25).fill(0);
        strategy.safeTiles.forEach(i => label[i] = 1);
        labels.push(label);
      });
      return { inputs, labels };
    }

    // Create & Train Model
    async function createAndTrainModel(inputs, labels) {
      const inputTensor = tf.tensor2d(inputs);
      const labelTensor = tf.tensor2d(labels);

      const model = tf.sequential();
      model.add(tf.layers.dense({ inputShape: [25], units: 64, activation: 'relu' }));
      model.add(tf.layers.dense({ units: 32, activation: 'relu' }));
      model.add(tf.layers.dense({ units: 25, activation: 'sigmoid' }));

      model.compile({ optimizer: 'adam', loss: 'binaryCrossentropy', metrics: ['accuracy'] });
      await model.fit(inputTensor, labelTensor, {
        epochs: 40,
        batchSize: 8,
        shuffle: true
      });

      return model;
    }

    async function loadStrategiesAndPredict() {
      const res = await fetch('strategies.json');
      const strategies = await res.json();

      const { inputs, labels } = prepareTrainingData(strategies);
      const model = await createAndTrainModel(inputs, labels);

      const emptyBoard = tf.tensor2d([new Array(25).fill(0)]);
      const prediction = model.predict(emptyBoard);
      const data = await prediction.data();

      highlightPredictions(data);
    }

    function highlightPredictions(probabilities) {
      probabilities.forEach((p, i) => {
        const tile = document.getElementById('tile-' + i);
        tile.classList.remove('safe');
        if (p > 0.6) {
          tile.classList.add('safe');
        }
      });
    }

    document.getElementById('predictBtn').addEventListener('click', () => {
      loadStrategiesAndPredict();
    });
  </script>
</body>
</html>
